<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Docker Compose &mdash; Fedora Developer Portal</title>
  <meta name="description" content="Fedora Developer Portal provides information for developers running  Fedora on their workstation or virtual machines.
">
  <link rel="canonical" href="http://developer.fedoraproject.org/tools/docker/compose.html">
  <!-- Link to Sitemap -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
  <link href="/css/main.css" rel="stylesheet" media="screen, print">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <!-- Site search -->
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    $(function() {
      $('#search-query').lunrSearch({
        indexUrl: '/js/index.json',   // Url for the .json file containing search index data
        results : '#search-results',  // selector for containing search results element
        entries : '.entries',         // selector for search entries containing element (contained within results above)
        template: '#search-results-template'  // selector for Mustache.js template
      });
    });
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-69605821-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>
  <body>
  <div style="background-color: #333">
<div class="container">
<div style="margin-bottom: 6px; margin-top: 6px" class="alert alert-warning">
<span class="pficon pficon-warning-triangle-o"></span>
  <strong> This is a development server. </strong>
  See the <a href="https://fedoraproject.org/wiki/Websites/Developer"> project wiki </a> for more information or visit the <b><a href="https://developer.fedoraproject.org"> Fedora Developer Portal</a></b> itself.
</div>
</div>
</div>
    <!-- The top blue thing -->
    <div id="splash" class="splash-size-small splash-section-tools">
      <div class="container">
        <div class="row" id="top">
  <div class="col-sm-2" id="logo-col">
    <div class="text-center">
      <h1>
        <a href="/">
          <img src="/static/logo_white.png" style="height: 46px; width: 152px;">
          <span>Fedora Developer Portal</span>
        </a>
      </h1>
    </div>
  </div>
  <div class="col-sm-7" id="menu-col">
    <nav>
  <ul class="nav navbar-nav">
    <li class="">
      <a href="/start.html">Start a project</a>
    </li>
    <li class=" active ">
      <a href="/tools.html">Get tools</a>
    </li>
    <li class="">
      <a href="/tech.html">Languages &amp; databases</a>
    </li>
    <li class="">
      <a href="/deployment.html">Deploy and distribute</a>
    </li>
    <!--
    <li class="">
      <a href="/">Resources</a>
    </li>
    <li class="">
      <a href="/">Blogs</a>
    </li>
    -->
  </ul>
</nav>
  </div>
  <div class="col-sm-3" id="search-col">
  <form class="input-group" id="search" action="/search.html" method="get">
    <input type="text" id="search-query" class="form-control" name="q" placeholder="Search" autocomplete="off">
    <span class="input-group-btn">
      <button class="btn btn-default glyphicon glyphicon-search" type="submit" aria-hidden="true"></button>
    </span>
  </form>
  <section id="search-results" style="display: none;">
    <div class="entries">
    </div>
  </section>
  <script id="search-results-template" type="text/mustache">
    {{#entries}}
      <article>
        <a href="{{url}}">{{title}}</a>
      </article>
    {{/entries}}
  </script>
  </div>
</div>
        <div class="row" id="headlines">
  <div class="col-sm-12">
          <img class="img-rounded" src="/static/logo/docker.png">
          <h2>Docker in Fedora</h2>
          <p>Platform for distributed applications.</p>
  </div>
</div>
<div class="row" id="attribution">
  <div class="col-sm-12">
    <a href=""></a>
  </div>
</div>
      </div>
    </div>
    <!-- Content -->
    <div class="container">
      <div class="row">
        <div class="col-sm-3">
          <div class="list-group content-menu">
                <a href="/tools/docker/about.html" class="list-group-item ">Docker in Fedora</a>
                <a href="/tools/docker/docker-interactive-management.html" class="list-group-item ">sen — interactive management</a>
                <a href="/tools/docker/docker-installation.html" class="list-group-item ">Getting started with Docker on Fedora</a>
                <a href="/tools/docker/docker-usage.html" class="list-group-item ">Docker basics</a>
                <a href="/tools/docker/docker-configuration.html" class="list-group-item ">Configuring Docker</a>
                <a href="/tools/docker/docker-images.html" class="list-group-item ">Docker images</a>
                <a href="/tools/docker/compose.html" class="list-group-item  active ">Docker Compose</a>
          </div>
          <div class="panel panel-default">
            <div class="panel-body" style="padding-top:8px;padding-bottom:8px">
              <div id="ask-fedora">
  Have a question?
    <a href="//ask.fedoraproject.org/">Ask Fedora.</a>
</div>
            </div>
          </div>
          <a href="https://github.com/developer-portal/content/blob/master//tools/docker//compose.md" class="btn btn-default">Edit this page</a>
        </div>
        <div class="col-sm-9">
          <div class="panel panel-default content-content">
            <h1 id="docker-compose">Docker Compose</h1>
<p><a href="https://docs.docker.com/compose/">Docker Compose</a> is a tool to orchestrate Docker containers using a simple YAML file which describes your whole setup.</p>
<h2 id="installation">Installation</h2>
<p>The package is named <code class="highlighter-rouge">docker-compose</code>, you can install it easily with:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo dnf install docker-compose
</code></pre></div></div>
<h2 id="example-usage">Example usage</h2>
<p>In this example we will go through a simple <a href="https://www.djangoproject.com/">Django</a> &amp; <a href="http://www.postgresql.org/">PostgreSQL</a> development environment setup managed by <code class="highlighter-rouge">docker-compose</code>. We will mount the application sources inside a Docker container, which will allow us to interpret code as we change it. The application container will be linked with the database container so our Django application will be able to communicate with our PostgreSQL database.</p>
<h3 id="prerequisites">Prerequisites</h3>
<h4 id="docker">Docker</h4>
<p>This guide expects that you have Docker engine installed, configured and running (for more information see <a href="/tools/docker/docker-installation.html">the Fedora installation guide</a>).</p>
<h4 id="images">Images</h4>
<p>We will use Fedora-based images from <a href="https://github.com/fedora-cloud/Fedora-Dockerfiles">fedora-dockerfiles</a>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/fedora-cloud/Fedora-Dockerfiles.git
</code></pre></div></div>
<p>Let’s start with Django.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker build --tag=fedora-django Fedora-Dockerfiles/Django
</code></pre></div></div>
<p>And now PostgreSQL (stock one is just fine):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker build --tag=fedora-postgresql Fedora-Dockerfiles/postgresql
</code></pre></div></div>
<h3 id="guide">Guide</h3>
<p>We will name our project <code class="highlighter-rouge">awesome_web</code>. So let’s start by creating a directory for the project (in a directory where you store your projects):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ${MY_PROJECTS}
$ mkdir awesome_web
$ cd awesome_web
</code></pre></div></div>
<p>Whole database will live in subdirectory <code class="highlighter-rouge">db</code> (<code class="highlighter-rouge">postgres</code> user has to own it — docker still lacks user namespaces; <code class="highlighter-rouge">26</code> is UID of <code class="highlighter-rouge">postgres</code> user, see <code class="highlighter-rouge">/usr/share/doc/setup/uidgid</code>):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir db
$ sudo chown 26:26 db
</code></pre></div></div>
<h4 id="docker-compose-configuration"><code class="highlighter-rouge">docker-compose</code> configuration</h4>
<p>First thing to do will be to create a YAML configuration file named <code class="highlighter-rouge">docker-compose.yml</code>. The file should live in the root of our project.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web:
  image: fedora-django
  ports:
   - "8000:8000"
  volumes:
   - ./awesome_web:/code
  links:
   - db
db:
  image: fedora-postgresql
  volumes:
   - ./db:/var/lib/pgsql/data
  environment:
   - POSTGRESQL_DATABASE=awesome_web
   - POSTGRESQL_USER=awesome_web_user
   - POSTGRESQL_PASSWORD=secret_password
</code></pre></div></div>
<p>Explanation:</p>
<p>Take <code class="highlighter-rouge">fedora-django</code> image and use it for <code class="highlighter-rouge">web</code> container, map port <code class="highlighter-rouge">8000</code> from container to <code class="highlighter-rouge">8000</code> on host, mount directory <code class="highlighter-rouge">awesome_web</code> (that’s where sources will be) to <code class="highlighter-rouge">/code</code> within container and link the <code class="highlighter-rouge">web</code> container to <code class="highlighter-rouge">db</code> container.</p>
<p><code class="highlighter-rouge">db</code> container is even more simple. Mount <code class="highlighter-rouge">db</code> directory inside container so PostgreSQL can populate it. We also need to set some environment variables to create database with username/password access (do not forget to change those!).</p>
<h4 id="create-django-project">Create Django project</h4>
<p>Let’s start new project with command <code class="highlighter-rouge">django-admin</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose run web django-admin startproject awesome_web .
</code></pre></div></div>
<p>Since the container runs as root by default, even our project will be created as root, let’s fix it:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo chown -R $UID:$UID awesome_web
</code></pre></div></div>
<p>Since we use PostgreSQL, we need to change <code class="highlighter-rouge">DATABASES</code> variable in <code class="highlighter-rouge">settings.py</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ $EDITOR awesome_web/awesome_web/settings.py
...
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'awesome_web',
        'USER': 'awesome_web_user',
        'PASSWORD': 'secret_password',
        'HOST': 'db',
        'PORT': 5432,
    }
}
...
</code></pre></div></div>
<h4 id="time-to-populate-database">Time to populate database</h4>
<p>Nowadays this is done by <code class="highlighter-rouge">manage.py migrate</code>. We need to run the database container first, then populate the database:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose up -d db
$ sudo docker-compose run web python manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: staticfiles, messages
  Apply all migrations: admin, contenttypes, auth, sessions
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
  Installing custom SQL...
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying sessions.0001_initial... OK
</code></pre></div></div>
<p>Is the database really populated?</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker exec -ti awesomeweb_db_1 bash
bash-4.3$ psql
psql (9.4.4)
Type "help" for help.


postgres=# \l
                                      List of databases
    Name     |      Owner       | Encoding |  Collate   |   Ctype    |   Access privileges
-------------+------------------+----------+------------+------------+-----------------------
 awesome_web | awesome_web_user | UTF8     | en_US.utf8 | en_US.utf8 |
 postgres    | postgres         | UTF8     | en_US.utf8 | en_US.utf8 |
 template0   | postgres         | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
             |                  |          |            |            | postgres=CTc/postgres
 template1   | postgres         | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
             |                  |          |            |            | postgres=CTc/postgres
(4 rows)

postgres=# 