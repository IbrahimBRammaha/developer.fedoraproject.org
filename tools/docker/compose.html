<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Docker Compose &mdash; Fedora Developer Portal</title>
  <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

  <link rel="canonical" href="http://developer.fedoraproject.org/tools/docker/compose.html">

  <!-- Link to Sitemap -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

  <link href="/css/main.css" rel="stylesheet" media="screen, print">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!--  <link href="/static/css/patternfly.min.css" rel="stylesheet" media="screen, print"> -->
  <script src="/static/components/jquery/dist/jquery.min.js"></script>
  <script src="/static/components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/static/components/datatables/media/js/jquery.dataTables.js"></script>
  <script src="/static/js/patternfly.min.js"></script>

  <!-- Site search -->
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    $(function() {
      $('#search-query').lunrSearch({
        indexUrl: '/js/index.json',   // Url for the .json file containing search index data
        results : '#search-results',  // selector for containing search results element
        entries : '.entries',         // selector for search entries containing element (contained within results above)
        template: '#search-results-template'  // selector for Mustache.js template
      });
    });
  </script>
</head>

  <body>
    <div class="container" id="header">
  <div class="row" id="top">
    <div class="col-sm-2" id="logo-col">
      <div class="text-center">
        <a href="/">
          <img src="/static/logo.png" style="height: 46px; width: 152px;">
          <span>Fedora Developer Portal</span>
        </a>
      </div>
    </div>
    <div class="col-sm-7">
      <nav>
  <ul class="nav navbar-nav">
    <li class=" active ">
      <a href="/tools.html">Get tools</a>
    </li>
    <li class="">
      <a href="/tech.html">Languages &amp; databases</a>
    </li>
    <li class="">
      <a href="/deployment.html">Deploy and distribute</a>
    </li>
    <!--
    <li class="">
      <a href="/">Resources</a>
    </li>
    <li class="">
      <a href="/">Blogs</a>
    </li>
    -->
  </ul>
</nav>

    </div>
    <div class="col-sm-3">
      
  <form class="input-group" id="search" action="/search.html" method="get">
    <input type="text" id="search-query" class="form-control" name="q" placeholder="Search" autocomplete="off">
    <span class="input-group-btn">
      <button class="btn btn-default glyphicon glyphicon-search" type="submit" aria-hidden="true"></button>
    </span>
  </form>
  <section id="search-results" style="display: none;">
    <div class="entries">
    </div>
  </section>

  
  <script id="search-results-template" type="text/mustache">
    {{#entries}}
      <article>
        <a href="{{url}}">{{title}}</a>
      </article>
    {{/entries}}
  </script>
  
</div>


    </div>
  </div>
</div>

    <div class="title container" id="">
      <div class="container">
        <div class="row">
          <div class="col-sm-6 col-xs-12" id="page-logo">
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                  <img class="img-circle" src="/static/logo/docker.png">
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
                
              
            
              
                
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                  <h1>Docker in Fedora</h1>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
                
              
            
              
                
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          </div>
          <div class="col-sm-6 Xhidden-xs" id="page-description">
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                  <p>Platform for distributed applications.</p>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
                
              
            
              
                
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        
        <div class="col-sm-3 col-sm-push-9">
          <div class="list-group">
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                <a href="/tools/docker/about.html" class="list-group-item ">Docker in Fedora</a>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                <a href="/tools/docker/docker-installation.html" class="list-group-item ">Getting started with Docker on Fedora</a>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                <a href="/tools/docker/docker-usage.html" class="list-group-item ">Docker basics</a>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                <a href="/tools/docker/docker-configuration.html" class="list-group-item ">Configuring Docker</a>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                <a href="/tools/docker/docker-images.html" class="list-group-item ">Docker images</a>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                
                <a href="/tools/docker/compose.html" class="list-group-item  active ">Docker Compose</a>
                
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          </div>
        </div>
        <div class="col-sm-9 col-sm-pull-3">
          <h1 id="docker-compose">Docker Compose</h1>

<p><a href="https://docs.docker.com/compose/">Docker Compose</a> is a tool to orchestrate Docker containers using a simple YAML file which describes your whole setup.</p>

<h2 id="installation">Installation</h2>

<p>The package is named <code>docker-compose</code>, you can install it easily with:</p>

<pre><code>$ sudo dnf install docker-compose
</code></pre>

<h2 id="example-usage">Example usage</h2>

<p>In this example we will go through a simple <a href="https://www.djangoproject.com/">Django</a> &amp; <a href="http://www.postgresql.org/">PostgreSQL</a> development environment setup managed by <code>docker-compose</code>. We will mount the application sources inside a Docker container, which will allow us to interpret code as we change it. The application container will be linked with the database container so our Django application will be able to communicate with our PostgreSQL database.</p>

<h3 id="prerequisites">Prerequisites</h3>

<h4 id="docker">Docker</h4>

<p>This guide expects that you have Docker engine installed, configured and running (for more information see <a href="/tools/docker/docker-installation.html">the Fedora installation guide</a>).</p>

<h4 id="images">Images</h4>

<p>We will use Fedora-based images from <a href="https://github.com/fedora-cloud/Fedora-Dockerfiles">fedora-dockerfiles</a>.</p>

<pre><code>$ git clone https://github.com/fedora-cloud/Fedora-Dockerfiles.git
</code></pre>

<p>Let’s start with Django.</p>

<pre><code>$ sudo docker build --tag=fedora-django Fedora-Dockerfiles/Django
</code></pre>

<p>And now PostgreSQL (stock one is just fine):</p>

<pre><code>$ sudo docker build --tag=fedora-postgresql Fedora-Dockerfiles/postgresql
</code></pre>

<h3 id="guide">Guide</h3>

<p>We will name our project <code>awesome_web</code>. So let’s start by creating a directory for the project (in a directory where you store your projects):</p>

<pre><code>$ cd ${MY_PROJECTS}
$ mkdir awesome_web
$ cd awesome_web
</code></pre>

<p>Whole database will live in subdirectory <code>db</code> (<code>postgres</code> user has to own it — docker still lacks user namespaces; <code>26</code> is UID of <code>postgres</code> user, see <code>/usr/share/doc/setup/uidgid</code>):</p>

<pre><code>$ mkdir db
$ sudo chown 26:26 db
</code></pre>

<h4 id="docker-compose-configuration"><code>docker-compose</code> configuration</h4>

<p>First thing to do will be to create a YAML configuration file named <code>docker-compose.yml</code>. The file should live in the root of our project.</p>

<pre><code>web:
  image: fedora-django
  ports:
   - "8000:8000"
  volumes:
   - ./awesome_web:/code
  links:
   - db
db:
  image: fedora-postgresql
  volumes:
   - ./db:/var/lib/pgsql/data
  environment:
   - POSTGRESQL_DATABASE=awesome_web
   - POSTGRESQL_USER=awesome_web_user
   - POSTGRESQL_PASSWORD=secret_password
</code></pre>

<p>Explanation:</p>

<p>Take <code>fedora-django</code> image and use it for <code>web</code> container, map port <code>8000</code> from container to <code>8000</code> on host, mount directory <code>awesome_web</code> (that’s where sources will be) to <code>/code</code> within container and link the <code>web</code> container to <code>db</code> container.</p>

<p><code>db</code> container is even more simple. Mount <code>db</code> directory inside container so PostgreSQL can populate it. We also need to set some environment variables to create database with username/password access (do not forget to change those!).</p>

<h4 id="create-django-project">Create Django project</h4>

<p>Let’s start new project with command <code>django-admin</code>:</p>

<pre><code>$ sudo docker-compose run web django-admin startproject awesome_web .
</code></pre>

<p>Since the container runs as root by default, even our project will be created as root, let’s fix it:</p>

<pre><code>$ sudo chown -R $UID:$UID awesome_web
</code></pre>

<p>Since we use PostgreSQL, we need to change <code>DATABASES</code> variable in <code>settings.py</code>:</p>

<pre><code>$ $EDITOR awesome_web/awesome_web/settings.py
...
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'awesome_web',
        'USER': 'awesome_web_user',
        'PASSWORD': 'secret_password',
        'HOST': 'db',
        'PORT': 5432,
    }
}
...
</code></pre>

<h4 id="time-to-populate-database">Time to populate database</h4>

<p>Nowadays this is done by <code>manage.py migrate</code>. We need to run the database container first, then populate the database:</p>

<pre><code>$ sudo docker-compose up -d db
$ sudo docker-compose run web python manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: staticfiles, messages
  Apply all migrations: admin, contenttypes, auth, sessions
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
  Installing custom SQL...
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying sessions.0001_initial... OK
</code></pre>

<p>Is the database really populated?</p>

<pre><code>$ sudo docker exec -ti awesomeweb_db_1 bash
bash-4.3$ psql
psql (9.4.4)
Type "help" for help.


postgres=# \l
                                      List of databases
    Name     |      Owner       | Encoding |  Collate   |   Ctype    |   Access privileges
-------------+------------------+----------+------------+------------+-----------------------
 awesome_web | awesome_web_user | UTF8     | en_US.utf8 | en_US.utf8 |
 postgres    | postgres         | UTF8     | en_US.utf8 | en_US.utf8 |
 template0   | postgres         | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
             |                  |          |            |            | postgres=CTc/postgres
 template1   | postgres         | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
             |                  |          |            |            | postgres=CTc/postgres
(4 rows)

postgres=# \connect awesome_web
You are now connected to database "awesome_web" as user "postgres".
awesome_web=# \dt
                       List of relations
 Schema |            Name            | Type  |      Owner
--------+----------------------------+-------+------------------
 public | auth_group                 | table | awesome_web_user
 public | auth_group_permissions     | table | awesome_web_user
 public | auth_permission            | table | awesome_web_user
 public | auth_user                  | table | awesome_web_user
 public | auth_user_groups           | table | awesome_web_user
 public | auth_user_user_permissions | table | awesome_web_user
 public | django_admin_log           | table | awesome_web_user
 public | django_content_type        | table | awesome_web_user
 public | django_migrations          | table | awesome_web_user
 public | django_session             | table | awesome_web_user
(10 rows)
</code></pre>

<p>This is how your directory layout should look:</p>

<pre><code>├── awesome_web
│   ├── awesome_web
│   │   ├── __init__.py
│   │   ├── settings.py
│   │   ├── urls.py
│   │   ├── wsgi.py
│   └── manage.py
├── db
│   ├── base
│   ├── global
│   ├── pg_clog
│   ├── pg_dynshmem
│   ├── pg_hba.conf
│   ├── pg_ident.conf
│   ├── pg_log
│   ├── &lt;...and more&gt;
└── docker-compose.yml
</code></pre>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>It may happen to you that something does not work and you will end up with error message like this:</p>

<pre><code>Starting awesomeweb_db_1...
Cannot start container bg1f8cb2d227a6efa5e82d9669235430f63dadc76a5ddd4907248f1edc11490a:
    Cannot link to a non running container: /awesomeweb_db_1 AS /awesomeweb_web_run_2/awesomeweb_db_1
</code></pre>

<p>Best way to figure out what went wrong is to check logs:</p>

<pre><code>$ sudo docker-compose logs
</code></pre>

<p>In thiscase , the <code>db</code> service was not running, so we can check logs of it exclusively:</p>

<pre><code>$ sudo docker-compose logs db
</code></pre>

<h3 id="time-to-spin-the-whole-environment">Time to spin the whole environment!</h3>

<pre><code>$ sudo docker-compose up
</code></pre>

<p>That’s it! You have your development environment running in docker containers! You can check easily:</p>

<pre><code>$ elinks -dump http://$(docker inspect -f '{{ .NetworkSettings.IPAddress }}' awesomeweb_web_1):8000
</code></pre>

        </div>
        <div class="col-xs-12">
          <hr>
          <div id="ask-fedora">
            Have a question?
            
              <a href="//ask.fedoraproject.org/en/questions/scope:all/sort:age-desc/tags:docker/page:1/">Ask Fedora.</a>
            
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
  <div class="container">
    <div class="row footerlinks">
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title">About</h3>
        <div class="widget-body">
          <dl>
            <dd><a href="/about.html">About Developer Portal</a></dd>
            <dd><a href="//getfedora.org/en/sponsors">About Fedora</a></dd>
            <dd><a href="//getfedora.org/en/sponsors">Sponsors</a></dd>
            <dd><a href="http://fedoramagazine.org">Fedora Magazine</a></dd>
            <dd><a href="//fedoraproject.org/wiki/Legal:Main#Legal">Legal</a></dd>
          </dl>
          <ul class="list-inline">
            <li>
              <a class="btn-social btn-outline" href="//www.facebook.com/TheFedoraProject"><i class="fa fa-fw fa-facebook"></i></a>
            </li>
            <li>
              <a class="btn-social btn-outline" href="//plus.google.com/112917221531140868607"><i class="fa fa-fw fa-google-plus"></i></a>
            </li>
            <li>
              <a class="btn-social btn-outline" href="//twitter.com/fedora"><i class="fa fa-fw fa-twitter"></i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title uppercase">Download</h3>
        <div class="widget-body">
          <dl>
            <dd><a href="//getfedora.org/en/workstation/download">Get Fedora Workstation</a></dd>
            <dd><a href="//getfedora.org/en/server/download">Get Fedora Server</a></dd>
            <dd><a href="//getfedora.org/en/cloud/download">Get Fedora Cloud</a></dd>
            <dd><a href="//spins.fedoraproject.org">Fedora Spins</a></dd>
            <dd><a href="//labs.fedoraproject.org">Fedora Labs</a></dd>
            <dd><a href="//arm.fedoraproject.org">Fedora ARM<span class="sup">&reg;</span></a></dd>
            <dd><a href="http://torrents.fedoraproject.org">Torrent Downloads</a></dd>
          </dl>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title">Support</h3>
          <div class="widget-body">
            <dl>
              <dd><a href="//fedoraproject.org/wiki/Communicating_and_getting_help">Get Help</a></dd>
              <dd><a href="//ask.fedoraproject.org/">Ask Fedora</a></dd>
              <dd><a href="http://fedoraforum.org/">Forums</a></dd>
              <dd><a href="//fedoraproject.org/wiki/Common_F22_bugs">Common Bugs</a></dd>
              <dd><a href="//docs.fedoraproject.org/en-US/Fedora/22/html/Installation_Guide">Installation Guide</a></dd>
            </dl>
          </div>
        </div>
        <div class="col-sm-3 col-xs-6 widget">
          <h3 class="widget-title">Join</h3>
            <div class="widget-body">
            <dl>
              <dd><a href="//fedoraproject.org/wiki/Join">Join Fedora</a></dd>
              <dd><a href="http://fedoraplanet.org">Planet Fedora</a></dd>
              <dd><a href="//fedoraproject.org/wiki/SIGs">Fedora SIGs</a></dd>
              <dd><a href="//admin.fedoraproject.org/accounts/">Fedora Account System</a></dd>
              <dd><a href="http://fedoracommunity.org/">Fedora Community</a></dd>
            </dl>
          </div>
        </div>
      </div> <!-- /row of widgets -->
      <div class="row">
        <div class="col-md-2">
          <div class="widget-body">
            <a href="http://www.redhat.com/"><img alt="Red Hat Logo" src="/static/logo/redhat.png" class="rh-logo"></a>
          </div>
        </div>
        <div class="col-md-7">
          <div class="widget-body">
            <p class="sponsor">Fedora is sponsored by Red Hat.</p>
            <p class="sponsor"><a href="//www.redhat.com/en/technologies/linux-platforms/articles/relationship-between-fedora-and-rhel">Learn more about the relationship between Red Hat and Fedora »</a></p>
            <p class="copy">&copy; 2015 Red Hat, Inc. and others.</p>
          </div>
        </div>
        <!-- /row of widgets -->
      </div>
</footer>

  </body>
</html>
